<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Derivada por Primer Principio</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff0f6;
      margin: 20px;
      color: #333;
    }
    h1 {
      color: #d63384;
      text-align: center;
    }
    label, input, button {
      font-size: 1.1em;
      margin: 10px;
    }
    input {
      width: 300px;
      padding: 8px;
    }
    button {
      background-color: #ff69b4;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    #output {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #ffd6e7;
    }
    .paso {
      margin-bottom: 20px;
    }
    #grafica {
      width: 100%;
      height: 450px;
    }
  </style>
</head>
<body>
  <h1>üß† Derivada por el Primer Principio</h1>
  <label for="funcion">Ingresa una funci√≥n (por ejemplo: x^2, sin(x), sqrt(x), ln(x)):</label><br/>
  <input type="text" id="funcion" placeholder="Ej: x^2" />
  <button onclick="resolver()">Resolver</button>
  <div id="output"></div>
  <div id="grafica"></div>

  <script>
    function f(x, expr) {
      try {
        return math.evaluate(expr, {x: x});
      } catch (e) {
        return NaN;
      }
    }

    function resolver() {
      const expr = document.getElementById("funcion").value;
      if (!expr) return;

      const parser = math.parser();
      let pasos = "";

      pasos += `<div class="paso"><b>1. F√≥rmula del Primer Principio:</b><br>
        \\[
        f'(x) = \\lim_{h \\to 0} \\frac{f(x + h) - f(x)}{h}
        \\]
      </div>`;

      pasos += `<div class="paso"><b>2. Funci√≥n original:</b><br>
        \\[
        f(x) = ${expr}
        \\]
      </div>`;

      const fxh = `(${expr.replace(/x/g, "(x+h)")})`;
      const fx = `(${expr})`;
      pasos += `<div class="paso"><b>3. Sustituimos en la f√≥rmula:</b><br>
        \\[
        \\frac{f(x+h) - f(x)}{h} = \\frac{${fxh} - ${fx}}{h}
        \\]
      </div>`;

      pasos += `<div class="paso"><b>4. Simplificamos el numerador:</b><br>
        Este paso depende de la funci√≥n, aqu√≠ simplemente lo dejamos indicado.
      </div>`;

      pasos += `<div class="paso"><b>5. Aplicamos el l√≠mite cuando h ‚Üí 0:</b><br>
        \\[
        \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}
        \\]
      </div>`;

      let derivada;
      try {
        derivada = math.derivative(expr, "x").toString();
      } catch (e) {
        derivada = "No se pudo calcular";
      }

      pasos += `<div class="paso"><b>6. Derivada obtenida:</b><br>
        \\[
        f'(x) = ${derivada}
        \\]
      </div>`;

      // Paso adicional si es funci√≥n tipo x^n
      if (/x\^/.test(expr)) {
        const potencia = expr.match(/x\^(\d+)/);
        if (potencia) {
          const n = potencia[1];
          pasos += `<div class="paso"><b>7. Aplicamos la regla de la potencia:</b><br>
            \\[
            \\frac{d}{dx} x^n = nx^{n-1} \\Rightarrow \\frac{d}{dx} x^${n} = ${n}x^{${n - 1}}
            \\]
          </div>`;
        }
      }

      pasos += `<div class="paso"><b>8. Interpretaci√≥n:</b><br>
        La derivada representa la pendiente de la recta tangente a la curva en un punto dado.
      </div>`;

      document.getElementById("output").innerHTML = pasos;
      MathJax.typeset();

      // Graficar
      let x = [], y = [];
      for (let i = -10; i <= 10; i += 0.5) {
        x.push(i);
        y.push(f(i, expr));
      }

      Plotly.newPlot('grafica', [{
        x: x,
        y: y,
        mode: 'lines',
        name: `f(x) = ${expr}`,
        line: { color: 'deeppink' }
      }], {
        margin: { t: 20 },
        xaxis: {
          title: 'x',
          gridcolor: '#eee',
          zeroline: true
        },
        yaxis: {
          title: 'f(x)',
          gridcolor: '#eee',
          zeroline: true
        },
        plot_bgcolor: '#fff0f6',
        paper_bgcolor: '#fff0f6'
      });
    }
  </script>

  <!-- Math.js para evaluar funciones -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.3.1/math.js"></script>
</body>
</html>
