<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Derivadas - Primer Principio</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 20px;
      background-color: #ffe6f0;
      color: #333;
    }
    h1 {
      color: #d63384;
    }
    input[type="text"] {
      padding: 10px;
      width: 300px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-right: 10px;
    }
    button {
      padding: 10px 20px;
      border: none;
      background-color: #d63384;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background-color: #c2185b;
    }
    .resultado, .pasos {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .paso {
      margin-bottom: 20px;
    }
    .formula {
      font-family: 'Courier New', monospace;
      background: #f8f0f4;
      padding: 10px;
      border-left: 4px solid #d63384;
    }
  </style>
</head>
<body>
  <h1>üß† Derivada por Primer Principio</h1>
  <p>Introduce la funci√≥n \( f(x) \) a derivar:</p>
  <input type="text" id="funcion" placeholder="Ej: x^2" />
  <button onclick="resolverDerivada()">Resolver</button>

  <div class="pasos" id="pasos"></div>
  <div class="resultado" id="grafico"></div>

  <script>
    function resolverDerivada() {
      const funcionOriginal = document.getElementById("funcion").value;
      const expr = math.parse(funcionOriginal);
      const pasos = document.getElementById("pasos");
      pasos.innerHTML = "";

      const fx = (x) => math.evaluate(funcionOriginal, { x });
      const h = 0.0001;

      // Paso 1
      pasos.innerHTML += `<div class='paso'><b>Paso 1:</b> Definici√≥n formal de derivada:<br><div class='formula'>f'(x) = lim (h‚Üí0) [f(x+h) - f(x)] / h</div></div>`;

      // Paso 2: Sustituci√≥n
      pasos.innerHTML += `<div class='paso'><b>Paso 2:</b> Sustituimos la funci√≥n en la definici√≥n:<br><div class='formula'>f'(x) = lim (h‚Üí0) [(${funcionOriginal.replaceAll("x", "(x+h)")} - (${funcionOriginal}))] / h</div></div>`;

      // Paso 3: Expandimos los t√©rminos (num√©rico)
      pasos.innerHTML += `<div class='paso'><b>Paso 3:</b> Evaluamos f(x+h) y f(x) para valores peque√±os:<br><div class='formula'>f(1+h) ‚âà ${fx(1 + h).toFixed(5)}<br>f(1) = ${fx(1).toFixed(5)}</div></div>`;

      // Paso 4: Calculamos el cociente de la diferencia
      const derivadaAprox = ((fx(1 + h) - fx(1)) / h).toFixed(5);
      pasos.innerHTML += `<div class='paso'><b>Paso 4:</b> Calculamos el cociente de la diferencia:<br><div class='formula'>[f(1+h) - f(1)] / h = (${fx(1 + h).toFixed(5)} - ${fx(1).toFixed(5)}) / ${h} = ${derivadaAprox}</div></div>`;

      // Paso 5: Aplicaci√≥n de la regla de la potencia (si aplica)
      if (/x\^\d/.test(funcionOriginal)) {
        const potencia = parseInt(funcionOriginal.match(/x\^(\d+)/)[1]);
        const coef = potencia;
        pasos.innerHTML += `<div class='paso'><b>Paso 5:</b> Aplicamos la regla de la potencia:<br><div class='formula'>Si f(x) = x^${potencia}, entonces f'(x) = ${coef}x^${potencia - 1}</div></div>`;
      }

      // Paso 6: Derivada simb√≥lica
      const derivada = math.derivative(funcionOriginal, 'x').toString();
      pasos.innerHTML += `<div class='paso'><b>Paso 6:</b> Derivada final simplificada:<br><div class='formula'>f'(x) = ${derivada}</div></div>`;

      // Gr√°fica
      const xval = [];
      const yval = [];
      const dyval = [];
      for (let i = -10; i <= 10; i += 0.5) {
        xval.push(i);
        try {
          yval.push(fx(i));
          dyval.push(math.evaluate(derivada, { x: i }));
        } catch (e) {
          yval.push(null);
          dyval.push(null);
        }
      }

      Plotly.newPlot("grafico", [
        {
          x: xval,
          y: yval,
          name: 'f(x)',
          line: { color: '#ff69b4' }
        },
        {
          x: xval,
          y: dyval,
          name: "f'(x)",
          line: { color: '#c2185b', dash: 'dot' }
        }
      ], {
        title: 'Gr√°fica de f(x) y su derivada',
        xaxis: { title: 'x', showgrid: true },
        yaxis: { title: 'y', showgrid: true },
        plot_bgcolor: '#fff0f5'
      });
    }
  </script>
</body>
</html>
